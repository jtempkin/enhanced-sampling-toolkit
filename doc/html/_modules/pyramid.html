

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pyramid &mdash; Enhanced Sampling Toolkit 0.1a documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="Enhanced Sampling Toolkit 0.1a documentation" href="../index.html"/>
        <link rel="up" title="Module code" href="index.html"/> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Enhanced Sampling Toolkit
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro.doc.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../walker_api/walker_api.doc.html">Walker API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/applications.doc.html">Applications</a></li>
<li class="toctree-l1"><a class="reference internal" href="../applications/examples/examples.doc.html">Examples - NEUS</a></li>
<li class="toctree-l1"><a class="reference internal" href="../test/testing.doc.html">Testing</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Enhanced Sampling Toolkit</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="index.html">Module code</a> &raquo;</li>
      
    <li>pyramid</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pyramid</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Class definition for Pyramid shaped window. Inherets from Window.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">window</span> <span class="kn">import</span> <span class="n">window</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">collections</span>

<div class="viewcode-block" id="Pyramid"><a class="viewcode-back" href="../applications/applications.doc.html#pyramid.Pyramid">[docs]</a><span class="k">class</span> <span class="nc">Pyramid</span><span class="p">(</span><span class="n">window</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class definition of Pyramid which inherits from window. Implements the pyramid shaped basis function.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">ref_center</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">ref_width</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">periodic_length</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">max_list_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">initial_conditions</span><span class="o">=</span><span class="p">[],</span> <span class="n">initial_conditions_probability</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">0.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create and instance of the pyramid at a center, given a width in each dimension.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># call parent constructor</span>
        <span class="n">window</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">center</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">ref_center</span><span class="o">=</span><span class="n">ref_center</span><span class="p">,</span> <span class="n">ref_width</span><span class="o">=</span><span class="n">ref_width</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="n">time</span><span class="p">,</span> <span class="n">periodic_length</span> <span class="o">=</span> <span class="n">periodic_length</span><span class="p">,</span> <span class="n">max_list_size</span><span class="o">=</span><span class="n">max_list_size</span><span class="p">,</span> <span class="n">initial_conditions</span><span class="o">=</span><span class="n">initial_conditions</span><span class="p">,</span> <span class="n">initial_conditions_probability</span><span class="o">=</span><span class="n">initial_conditions_probability</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">)</span>

        <span class="c1"># We calculate the slope of the pyramid.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slopes</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span>

        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the string represetation of the Pyramid instance.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="s2">&quot;Pyramid(&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;, &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">width</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;)&quot;</span>

        <span class="k">return</span> <span class="nb">id</span>

    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">walker</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the value of the support for this Pyramid object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># DEVLEOPER Note: this is the key for how the NEUS application module relies on the walker object definition. We have to think carefully about how exactly we want the window object accept input in the call function. Should this explicitly make assumptions about the structure and callable functions of the walker class or should we try to generalize this to act through something like a numpy array?</span>

        <span class="c1"># second comment: This question arises separately really from how we wish this call function is implemented from a partition object. The partition object will</span>

        <span class="c1"># ok, here we are going to implement the window on top if the walker object definition. But we will enforce that the behavoir of Pyramid&#39;s call will depend on both the definition of the reference and the information it can get from walker.</span>

        <span class="c1"># check to see that we&#39;ve received a walker object</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">walker</span><span class="o">.</span><span class="n">get_colvars</span><span class="p">()</span>

        <span class="k">assert</span> <span class="n">coord</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;walker collective variables array does not match the shape of this window instance definition.&quot;</span>

        <span class="c1"># create a distance vector</span>
        <span class="n">distancevec</span> <span class="o">=</span> <span class="n">coord</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">center</span>

        <span class="c1"># if any collective variable is periodic, construct dr, the adjuct for minimum image convention for the periodic cv&#39;s</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

            <span class="c1"># build dr</span>
            <span class="n">dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">distancevec</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            <span class="c1"># add values to dr if the CV wraps</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="c1"># This is an old trick from MD codes to find the minimum distance between two points.</span>
                    <span class="n">dr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">distancevec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="c1"># add min image vector</span>
            <span class="n">distancevec</span> <span class="o">-=</span> <span class="n">dr</span>

        <span class="c1"># We calculate the value of</span>
        <span class="n">psiparts</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">slopes</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">distancevec</span><span class="p">)</span>

        <span class="n">val</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">psiparts</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="nb">min</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_center</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

            <span class="c1"># check to see that</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">walker</span><span class="p">,</span> <span class="s2">&quot;get_initial_colvars&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Walker object passed to Pyramid __call__ does not have support for getting refernce collective variable value.&quot;</span><span class="p">)</span>

            <span class="c1"># return initial state of the collective variable</span>
            <span class="n">ref_coord</span> <span class="o">=</span> <span class="n">walker</span><span class="o">.</span><span class="n">get_initial_colvars</span><span class="p">()</span>

            <span class="n">val</span> <span class="o">*=</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_indicator</span><span class="p">(</span><span class="n">ref_coord</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># check that the passed walker object has a time coordinate</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">walker</span><span class="p">,</span> <span class="s2">&quot;get_time&quot;</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Walker object passed to Pyramid __call__ does not have support for getting time value.&quot;</span><span class="p">)</span>

            <span class="c1"># get time</span>
            <span class="n">time</span> <span class="o">=</span> <span class="n">walker</span><span class="o">.</span><span class="n">get_time</span><span class="p">()</span>

            <span class="c1"># return indicator and multiply against support value</span>
            <span class="n">val</span> <span class="o">*=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_indicator</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>


        <span class="c1">#  return the minimum value.</span>
        <span class="k">return</span> <span class="n">val</span>

<div class="viewcode-block" id="Pyramid.ref_indicator"><a class="viewcode-back" href="../applications/applications.doc.html#pyramid.Pyramid.ref_indicator">[docs]</a>    <span class="k">def</span> <span class="nf">ref_indicator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the value of the indicator for the reference.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">assert</span> <span class="n">coord</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_center</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="s2">&quot;walker reference collective variables array does not match the shape of this window reference center.&quot;</span>

        <span class="c1"># create a distance vector</span>
        <span class="n">distancevec</span> <span class="o">=</span> <span class="n">coord</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ref_center</span>

        <span class="c1"># if any collective variable is periodic, construct dr, the adjuct for minimum image convetion for the periodic cv&#39;s</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

            <span class="c1"># build dr</span>
            <span class="n">dr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">distancevec</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

            <span class="c1"># add values to dr if the CV wraps</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span><span class="p">)):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">:</span>
                    <span class="c1"># This is an old trick from MD codes to find the minimum distance between two points.</span>
                    <span class="n">dr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">rint</span><span class="p">(</span><span class="n">distancevec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">wrapping</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="c1"># add min image vector</span>
            <span class="n">distancevec</span> <span class="o">-=</span> <span class="n">dr</span>

        <span class="c1"># We return 1.0 if all the distances are smaller than the width of the box from the center, 0.0 otherwise.</span>
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ref_width</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">distancevec</span><span class="p">)))</span></div>


<div class="viewcode-block" id="Pyramid.time_indicator"><a class="viewcode-back" href="../applications/applications.doc.html#pyramid.Pyramid.time_indicator">[docs]</a>    <span class="k">def</span> <span class="nf">time_indicator</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">coord</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the value of the indicator function for the time coordinate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_start</span> <span class="o">&lt;=</span> <span class="n">coord</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_end</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">1.0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="mf">0.0</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2015, Jeremy O. B. Tempkin.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.1a',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>